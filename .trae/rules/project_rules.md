# 🎵 Lrc2Video 项目开发规则

## 📋 项目概述
Lrc2Video 是一个现代化的Python桌面应用，专为音乐创作者和内容制作者设计，将歌词文件（LRC）与音频文件智能合成为精美的歌词视频。

## 🏗️ 项目架构规则

### 目录结构规范
```
Lrc2Video/
├── core/           # 核心功能模块
├── gui/            # 图形界面模块
├── utils/          # 工具函数模块
├── config/         # 配置文件目录
├── style_templates/# 样式模板目录
├── scripts/        # 脚本工具目录
├── output/         # 输出文件目录
├── logs/           # 日志文件目录
└── docs/           # 文档目录（如需要）
```

### 模块职责划分
- **core/**: 视频生成核心逻辑，包括音频处理、歌词解析、视频合成
- **gui/**: 用户界面相关，包括主窗口、对话框、主题样式
- **utils/**: 通用工具函数，如配置管理、文件操作、硬件检测
- **config/**: 统一配置文件管理，支持JSON格式配置
- **style_templates/**: 预设样式模板，支持导入导出功能

## 📝 代码开发规范

### Python编码标准
1. **遵循PEP 8**: 使用4空格缩进，最大行长度79字符
2. **导入规范**: 标准库 → 第三方库 → 本地模块，每类之间空一行
3. **类型注解**: 关键函数必须添加类型注解
4. **文档字符串**: 所有公共函数和类必须有docstring

### 命名规范
- **类名**: PascalCase，如 `VideoGenerator`
- **函数/方法**: snake_case，如 `generate_video()`
- **常量**: UPPER_SNAKE_CASE，如 `MAX_FONT_SIZE`
- **私有变量**: 前缀下划线，如 `_internal_var`

### 错误处理
- 使用try-except捕获特定异常，避免裸except
- 记录详细错误日志，包括异常类型和堆栈信息
- 用户友好的错误提示，避免显示技术细节

## 🎨 UI/UX设计规范

### 界面一致性
- 使用统一的现代主题样式（参考 `gui/modern_theme.py`）
- 所有对话框必须居中显示
- 按钮布局：确定/取消按钮在对话框右下角
- 进度条显示必须包含百分比和剩余时间估算

### 用户体验
- 所有耗时操作必须显示进度条
- 关键操作需要确认对话框
- 自动保存用户设置和偏好
- 提供撤销/重做功能（如适用）

## 🔧 配置管理规则

### 配置文件结构
使用统一的JSON配置文件 `config/config.json`，包含：
- 应用设置（主题、语言、窗口状态）
- AI配置（提供商、API密钥、参数）
- 视频设置（分辨率、帧率、编码参数）
- 歌词样式（字体、颜色、特效）
- 路径配置（输入/输出目录）

### 配置迁移
- 提供配置迁移脚本 `scripts/migrate_config.py`
- 向后兼容旧版本配置
- 自动备份现有配置

## 🚀 性能优化规则

### 资源管理
- 及时释放大内存对象（视频帧、音频数据）
- 使用生成器处理大批量文件
- 实现断点续传功能
- 限制并发线程数量

### 缓存策略
- 缓存系统字体列表
- 缓存AI生成的标题
- 缓存视频处理中间结果

## 🛡️ 安全规范

### 数据安全
- API密钥必须加密存储
- 用户文件路径验证，防止路径遍历攻击
- 输出文件权限设置合理

### 依赖安全
- 定期更新第三方库
- 使用虚拟环境隔离依赖
- 锁定关键依赖版本

## 🧪 测试规范

### 测试覆盖
- 核心功能必须有单元测试
- UI组件需要集成测试
- 边界条件测试

### 测试数据
- 提供标准测试用例
- 包含异常数据处理测试
- 性能基准测试

## 📊 日志规范

### 日志级别
- DEBUG: 详细调试信息
- INFO: 重要操作记录
- WARNING: 潜在问题
- ERROR: 错误信息

### 日志格式
```
[YYYY-MM-DD HH:MM:SS] LEVEL - MODULE - MESSAGE
```

### 日志文件
- 按日期生成日志文件
- 自动清理过期日志（保留30天）
- 错误日志单独记录

## 🔄 版本管理

### 版本号规范
遵循语义化版本控制（SemVer）：`主版本.次版本.修订版本`

### 版本发布
- 更新版本号
- 更新CHANGELOG.md
- 创建发布标签
- 更新文档

## 📞 支持规范

### 错误报告
- 包含复现步骤
- 提供日志文件
- 系统环境信息

### 功能请求
- 描述使用场景
- 提供参考案例
- 评估实现难度

## 🎯 开发流程

### 新功能开发
1. 创建功能分支
2. 编写实现代码
3. 添加测试用例
4. 更新文档
5. 代码审查
6. 合并到主分支

### Bug修复
1. 创建修复分支
2. 定位问题根因
3. 编写修复代码
4. 添加回归测试
5. 验证修复效果
6. 合并到主分支

## 🚫 禁止事项

### 代码质量
- 禁止硬编码敏感信息
- 禁止忽略异常而不处理
- 禁止使用已过时的API
- 禁止在循环中频繁操作文件系统

### 用户体验
- 禁止静默失败
- 禁止无响应的UI操作
- 禁止强制用户重复输入
- 禁止删除用户数据而不确认

### 性能问题
- 禁止内存泄漏
- 禁止阻塞主线程的耗时操作
- 禁止无限制的资源占用
- 禁止重复计算相同结果

## ✅ 最佳实践

### 代码复用
- 提取公共函数到utils模块
- 使用继承减少代码重复
- 创建可配置的通用组件

### 文档维护
- 保持README.md最新
- 维护配置说明
- 记录已知问题

### 社区贡献
- 欢迎Pull Request
- 提供清晰的贡献指南
- 及时响应Issue
- 感谢贡献者